app-id: org.routeplanner.RoutePlanner
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
command: route-planner
finish-args:
  - --share=network
  - --share=ipc  
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=home
  - --env=QT_QPA_PLATFORM=wayland;xcb

modules:
  - name: route-planner
    buildsystem: simple
    build-commands:
      - mkdir -p /app/lib/route-planner/
      - cp -r . /app/lib/route-planner/
      - mkdir -p /app/bin
      - |
        cat > /app/bin/route-planner << 'EOF'
        #!/bin/bash
        cd "/app/lib/route-planner"
        export PYTHONPATH="/app/lib/route-planner:${PYTHONPATH}"
        exec python3 main.py "$@"
        EOF
      - chmod +x /app/bin/route-planner
      - mkdir -p /app/share/applications
      - |
        cat > /app/share/applications/org.routeplanner.RoutePlanner.desktop << 'EOF'
        [Desktop Entry]
        Name=Route Planner
        Comment=Delivery Route Optimizer
        Exec=route-planner
        Icon=org.routeplanner.RoutePlanner
        Terminal=false
        Type=Application
        Categories=Office;Utility;
        EOF
      - mkdir -p /app/share/icons/hicolor/64x64/apps
      - mkdir -p /app/share/icons/hicolor/128x128/apps
      - |
        # Use existing icon if available, otherwise copy from project root
        if [ -f "icons/org.routeplanner.RoutePlanner-64.png" ]; then
          cp icons/org.routeplanner.RoutePlanner-64.png /app/share/icons/hicolor/64x64/apps/org.routeplanner.RoutePlanner.png
          cp icons/org.routeplanner.RoutePlanner-128.png /app/share/icons/hicolor/128x128/apps/org.routeplanner.RoutePlanner.png
        elif [ -f "icon.ico" ]; then
          # Convert ICO to PNG if ImageMagick is available
          if command -v convert >/dev/null 2>&1; then
            convert icon.ico[0] -resize 64x64 /app/share/icons/hicolor/64x64/apps/org.routeplanner.RoutePlanner.png
            convert icon.ico[0] -resize 128x128 /app/share/icons/hicolor/128x128/apps/org.routeplanner.RoutePlanner.png
          else
            # Copy the ICO file as fallback (some systems can handle it)
            cp icon.ico /app/share/icons/hicolor/64x64/apps/org.routeplanner.RoutePlanner.png
            cp icon.ico /app/share/icons/hicolor/128x128/apps/org.routeplanner.RoutePlanner.png
          fi
        else
          # Create a minimal placeholder icon
          echo "Creating placeholder icon..."
          touch /app/share/icons/hicolor/64x64/apps/org.routeplanner.RoutePlanner.png
          touch /app/share/icons/hicolor/128x128/apps/org.routeplanner.RoutePlanner.png
        fi
      - mkdir -p /app/share/metainfo
      - |
        cat > /app/share/metainfo/org.routeplanner.RoutePlanner.metainfo.xml << 'EOF'
        <?xml version="1.0" encoding="UTF-8"?>
        <component type="desktop-application">
          <id>org.routeplanner.RoutePlanner</id>
          <metadata_license>MIT</metadata_license>
          <project_license>MIT</project_license>
          <name>Route Planner</name>
          <summary>Delivery Route Optimizer</summary>
          <description>
            <p>A sophisticated desktop application for optimizing delivery routes with support for multiple file formats and interactive maps.</p>
          </description>
          <categories>
            <category>Office</category>
            <category>Utility</category>
          </categories>
          <url type="homepage">https://github.com/innoxent/Route_Planner</url>
        </component>
        EOF
    sources:
      - type: dir
        path: .
