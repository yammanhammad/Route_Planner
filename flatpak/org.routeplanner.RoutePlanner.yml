app-id: org.routeplanner.RoutePlanner
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
command: route-planner
finish-args:
  - --share=network
  - --share=ipc  
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=home
  - --env=QT_QPA_PLATFORM=wayland;xcb

modules:
  - name: route-planner
    buildsystem: simple
    build-commands:
      - mkdir -p /app/lib/route-planner/
      - cp -r . /app/lib/route-planner/
      - mkdir -p /app/bin
      - |
        cat > /app/bin/route-planner << 'EOF'
        #!/bin/bash
        cd "/app/lib/route-planner"
        export PYTHONPATH="/app/lib/route-planner:${PYTHONPATH}"
        python3 -c "
import sys
import os
sys.path.insert(0, '/app/lib/route-planner')

try:
    import PyQt5
    print('Starting Route Planner GUI...')
    from route_planner.core import main
    main()
except ImportError as e:
    print('PyQt5 not available, starting in console mode...')
    print('Error:', str(e))
    try:
        from route_planner.console import console_main
        console_main()
    except Exception as console_e:
        print('Console mode also failed:', str(console_e))
        print('Please install the dependencies manually.')
        sys.exit(1)
" "$@"
        EOF
      - chmod +x /app/bin/route-planner
      - mkdir -p /app/share/applications
      - |
        cat > /app/share/applications/org.routeplanner.RoutePlanner.desktop << 'EOF'
        [Desktop Entry]
        Name=Route Planner
        Comment=Delivery Route Optimizer
        Exec=route-planner
        Terminal=false
        Type=Application
        Categories=Office;Utility;
        EOF
      - mkdir -p /app/share/metainfo
      - |
        cat > /app/share/metainfo/org.routeplanner.RoutePlanner.metainfo.xml << 'EOF'
        <?xml version="1.0" encoding="UTF-8"?>
        <component type="desktop-application">
          <id>org.routeplanner.RoutePlanner</id>
          <metadata_license>MIT</metadata_license>
          <project_license>MIT</project_license>
          <name>Route Planner</name>
          <summary>Delivery Route Optimizer</summary>
          <description>
            <p>A sophisticated desktop application for optimizing delivery routes with support for multiple file formats and interactive maps.</p>
          </description>
          <categories>
            <category>Office</category>
            <category>Utility</category>
          </categories>
          <url type="homepage">https://github.com/innoxent/Route_Planner</url>
        </component>
        EOF
    sources:
      - type: dir
        path: .
